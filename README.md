# FaceRadar
 Project to detect faces from webcam

# Установка
## Необходимые модули
- cv2 (opencv-python)
- face_recognition (+dlib)
- requests
- sys
- argparse

Рекомендуемая версия python 3.8.5

## Установка модулей
Чтобы установить модуль, используйте консольную команду:
pip install имя модуля
или
запустить setup.py

# Параметры
Доступные параметры (краткое название консольной переменной, полное название консольной переменной, название переменной окружения, значение по умолчанию):
- wc | webcam | CAMERA_SOURCE (0) - индекс локальной камеры или адрес веб-камеры
- id | idSource | ID_SOURCE (0) - идентификатор текущего ПО, нужен для сетевого взаимодействия
- ud | urlDist | URL_DIST ("http://127.0.0.1:8000") - адрес url сервера, на который отправляются распознанные лица
- kf | kMinFace | K_MIN_FACE (0.01) - порог распознавания лица: доля по среднему арифметическому отношений ширины и высоты к экрану 
- md | maxDistance | MAX_DISTANCE (0.9) - максимальное расстояние между центрами лиц, при котором они считаются одним. Измеряется в долях по отношению к наименьшей стороне прямоугольника лица 
- kp | kadrToProcess | KADR_TO_PROCESS (100) - частота обработки кадров: количество кадров, которые будут пропущены между обрабатываемыми кадрами. Напрямую влияет на производитедбность 
- ke | maxKadrEmpty | MAX_KADR_EMPTY (50) - количество кадров, в течение которых прежние положения лиц будут храниться в памяти для трекинга 
- iw | maxInAccessWebcam | MAX_INACCESS_WEBCAM (1) - количество непринятых кадров до завершения программы 
- kx | kx | K_X (0.5),   
  ky | ky | K_Y (0.5) - коэффициенты масштабирования изображения перед обработкой, умножаются на стороны прямоугольника исходного изображения 

## В редакторе python
Можно настроить необходимые параметры в качестве значений по умолчанию в файле ConsoleArgParse

## В консоли
Пример:
python main.py -wc "rtsp://nikname:password@123.456.789.000:0000/ISAPI/Streaming/Channels/101" -kf 0.15 -kx 1 -ky 1

## Примечание
Окно закрывается клавишей Esc, консоль сочетанием Ctrl+C

# Настройка параметров
## Основные задачи
Если нужна скорость обработки (снизить нагрузку на оборудование):
- Уменьшить kx, ky. Теряется качество изображения и дистанция обнаружения лиц.
- увеличить kadrToProcess. Теряется качество трекинга, возможно генерирование лишних лиц.

Если нужна вероятность обнаружения:
- увеличить kx, ky (вплоть до 1). Теряется скорость обработки (увеличивается нагрузка)
- уменьшить kMinFace. Возможны ложные срабатывания на бейджики.

Если нужно улучшить трекинг (уменьшить вероятность повторной отправки):
- уменьшить kadrToProcess. Теряется скорость обработки (увеличивается нагрузка)
- увеличить maxDistance. Уменьшается вероятность обнаружения новых людей, есть риск перепутать их со старыми
- увеличить maxKadrEmpty. Уменьшается вероятность обнаружения новых людей, есть риск перепутать их со старыми

## Прикладные задачи:

Если нужно отследить людей, которые быстро передвигаются:
- улучшить трекинг (со всеми последствиями)
- увеличить kx, ky (вплоть до 1). Теряется скорость обработки (увеличивается нагрузка)

Если нужно отследить людей вдали:
- увеличить kx, ky (вплоть до 1). Теряется скорость обработки (увеличивается нагрузка)

## Примечания:
- коэффициенты kx, ky влияют на изображение при обработке. На качество отправляемого лица они не влияют, отправляемое лицо вырезается из исходного изображения.


